<!DOCTYPE html>
<html>
<head>
    <title>Debug Condition Evaluation</title>
</head>
<body>
    <div id="output"></div>
    <script src="lib/miniscript-shim.js"></script>
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += message.replace(/\n/g, '<br>') + '<br>';
        }
        
        log("Testing condition evaluation...");
        
        const interpreter = new miniscript.Interpreter();
        
        // Override evalCondition to add debugging
        const originalEvalCondition = interpreter.evalCondition;
        interpreter.evalCondition = function(condition) {
            log("evalCondition: '" + condition + "'");
            const result = originalEvalCondition.call(this, condition);
            log("-> " + result);
            return result;
        };
        
        try {
            log("\n=== Test: Variable assignment ===");
            interpreter.run('poppedValue = [5, 6]');
            log("poppedValue: " + JSON.stringify(interpreter.variables.poppedValue));
            
            log("\n=== Test: Direct condition evaluation ===");
            const condition = 'poppedValue != null';
            const result = interpreter.evalCondition(condition);
            log("Final result: " + result);
            
            log("\n=== Test: Parts splitting ===");
            const parts = interpreter.smartSplit(condition, "!=");
            log("Parts: " + JSON.stringify(parts));
            if (parts.length === 2) {
                const left = interpreter.evalExpr(parts[0].trim());
                const right = interpreter.evalExpr(parts[1].trim());
                log("Left: " + JSON.stringify(left));
                log("Right: " + JSON.stringify(right));
                log("left != right: " + (left != right));
            }
            
        } catch (error) {
            log("Error: " + error.message);
            console.error(error);
        }
    </script>
</body>
</html>
